# 类加载机制

## 类加载过程

### 1. 加载

* 加载时机
  * main方法入口
  * new
  * 静态方法调用/静态常量引用

### 2. 验证

主要验证以下数据

* 文件格式 class文件格式 class文件有规范的格式要求
* 元数据 父类、
* 字节码验证
* 符号应用的验证

### 3. 准备

* 初始化类变量 把类变量为分配的空间清理干净，主要是针对static变量，因为static变量是属于类维度，这一阶段主要是处理类，还未创建对象。比如 int 类型初始化为0。如果是final static类型则初始化为初变量定义的右值。

### 4. 解析

* 解析方法、字段、常量等。

### 5. 初始化

* 执行类构造器clinit()方法，主要是static代码块和为static变量赋值

### 6. 使用

### 7. 卸载

## 类加载器

## 启动类加载器

加载java启动核心的lib，在JAVA_HOME/lib目录下的类由它加载。

## 扩展类加载器

负责加载JAVA_HOME/lib/ext中的所有类库。

## 应用类加载器

加载classpath下的类，一般应用使用的是应用类加载器。

# 双亲委派
这是一个约束，类加载的时候当前类加载器会先请求父类加载器加载，如果父类加载器加载完成，则类加载完成，如果父类加载器未加载成功，才会由当前类加载器去加载。

## 破坏双亲委派的情况

* jdk1.2之前的类加载器模型
* JNDI情况下线程上下文类加载器
* OSGI模块化设计情况下
